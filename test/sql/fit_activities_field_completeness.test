# name: test/sql/fit_activities_field_completeness.test
# description: Test field completeness in fit_activities and document expected empty values
# group: [sql]

require fit

# Create test table
statement ok
CREATE TEMP TABLE activities AS SELECT * FROM fit_activities('./sample.fit');

# Test 1: Sport field - should always be populated from session data
query I
SELECT sport = 'E-Biking' FROM activities;
----
true

# Test 2: Product field - should be populated with product name when available
query I
SELECT product = 'Intervals.icu' FROM activities;
----
true

# Test 3: File ID field - may be empty if FIT file doesn't set Number field
# This is expected behavior for files that don't set this optional field
query I
SELECT file_id IS NULL OR file_id = '' FROM activities;
----
true

# Test 4: Total calories - should match session data (may be 0 if not recorded)
statement ok
CREATE TEMP TABLE sessions AS SELECT * FROM fit_sessions('./sample.fit');

query I
SELECT a.total_calories = s.total_calories FROM activities a, sessions s;
----
true

# Test 5: Verify that 0 calories is expected for this specific file
query I
SELECT total_calories = 0 FROM activities;
----
true

# Test 6: Manufacturer should be human-readable
query I
SELECT manufacturer = 'Development' FROM activities;
----
true

# Test 7: Verify essential fields are populated
query I
SELECT
    sport IS NOT NULL AND sport != '' AND
    total_distance > 0 AND
    total_elapsed_time > 0 AND
    manufacturer IS NOT NULL AND manufacturer != ''
FROM activities;
----
true

# Test 8: Document specific field behaviors
# - sport: Populated from session data ✓
# - product: Populated from ProductName when available ✓
# - file_id: Empty when FIT file doesn't set Number field (normal) ✓
# - total_calories: 0 when device doesn't record calories (normal) ✓

# Clean up
statement ok
DROP TABLE activities;

statement ok
DROP TABLE sessions;
